Port of the issue 26 from filetree://